<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planner</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* Additional custom styles if needed */
        body {
          background-color: #343a40; /* Darker background color */
        }
    </style>
</head>
<body class="bg-dark text-white">
<div class="container mt-4">
    <h1 class="text-center mb-4">Welcome to the Planner</h1>

    <div class="card mb-4 bg-secondary">
        <div class="card-body">
            <h2 class="card-title">Current Planner Data:</h2>
            <h3 class="card-subtitle mb-3">Select your destination</h3>
            <form id="filter-form" class="form-inline justify-content-center">
                <div class="form-group mx-sm-3 mb-2">
                    <label for="city" class="sr-only">Select destination</label>
                    <select name="city" id="city" class="form-control">
                        <!-- The "Show All" option will be dynamically added here -->
                    </select>
                </div>
                <button type="submit" class="btn btn-primary mb-2">Filter</button>
            </form>
        </div>
    </div>

    <h3 class="mb-3">Flight Data:</h3>
    <ul id="planner-data" class="list-group">
        <!-- List of planner data will be dynamically inserted here -->
    </ul>
</div>

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    // Function to fetch flight data from the backend
    function fetchFlights(city = '') {
      let url = '/lennud';  // Default URL to fetch all flights

      // If a city is selected, append the city filter to the URL
      if (city && city !== 'all') {
        url = `/filter?city=${city}`;
      }

      fetch(url)
        .then(response => response.json())
        .then(data => {
          const plannerDataList = document.getElementById('planner-data');
          plannerDataList.innerHTML = ''; // Clear existing data

          data.forEach(item => {
            const li = document.createElement('li');
            li.className = 'list-group-item list-group-item-action';
            li.style.cursor = 'pointer';
            li.textContent = `City: ${item.city}, Date: ${item.date}, Time: ${item.time}`;

            // Redirect to seating page with flight details on click
            li.addEventListener('click', function () {
              window.location.href = `/seating.html?city=${item.city}&date=${item.date}&time=${item.time}`;
            });

            plannerDataList.appendChild(li);
          });
        })
        .catch(error => console.error('Error fetching flights:', error));
    }

    // Function to fetch all cities for the dropdown
    function fetchCities() {
      fetch('/cities')
        .then(response => response.json())
        .then(cities => {
          const citySelect = document.getElementById('city');
          citySelect.innerHTML = '';

          const allOption = document.createElement('option');
          allOption.value = 'all';
          allOption.textContent = 'Show All';
          citySelect.appendChild(allOption);

          cities.forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            citySelect.appendChild(option);
          });
        })
        .catch(error => console.error('Error fetching cities:', error));
    }

    // Fetch flights and cities on page load
    fetchFlights();
    fetchCities();

    // Add event listener to the filter form
    document.getElementById('filter-form').addEventListener('submit', function(event) {
      event.preventDefault();
      const selectedCity = document.getElementById('city').value;
      fetchFlights(selectedCity);
    });
</script>
</body>
</html>
